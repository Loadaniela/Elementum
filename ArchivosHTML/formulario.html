<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
    <link rel="stylesheet" href="/css/estilosJuego.css">
</head>
<body>
    <main>

        <input type="checkbox" id="toggle">
        <label for="toggle" class="hamburger"><span></span><span></span><span></span></label>
        <nav class="menu">
            <ul>
                <li><a href="#" >PERFIL DEL JUGADOR</a></li>
                <p><strong style="color: orange;">Jugador:</strong> <span id="nombre" style="color: white;"></span></p>
                <p><strong style="color: orange;">Correo:</strong> <span id="correo" style="color: white;"></span></p>
                <p><strong style="color: orange;">Usuario:</strong> <span id="usuario" style="color: white;"></span></p>
                <li><a href="pagina1.html">Menú Principal</a></li>
                <li><a href="login.html" id="logout">Cerrar sesión</a></li>
                <img src="Imagenes/oncahui.png" alt="panda" width="220" height="350">
            </ul>
        </nav>
        <h1 class="glitch"  data-text="Elementum">ELEMENTUM</h1>

    
        <div id="contenedorFormulario" style="text-align: center;">

        <h1 id="formulario">Formulario Elementum</h1>
        <form id="formularioPregunta">
            <label for="pregunta" >Pregunta a insertar:</label><br>
            <input type="text" id="pregunta" name="pregunta" required  placeholder="Escribe tu pregunta aquí"><br><br>
    
            <label for="respuestaCorrecta">Respuesta correcta:</label><br>
            <select id="respuestaCorrecta" name="respuestaCorrecta" required>
                <option value="true">Verdadero</option>
                <option value="false">Falso</option>
            </select><br><br>
    
            <label for="simboloElemento">Seleccione el elemento del cual será la pregunta:</label><br>
            <select id="simboloElemento" name="simboloElemento" required>
                <option value="" disabled selected>Seleccionar elemento</option>
                <!-- Aquí van los símbolos de los elementos químicos -->
                <option value="H">Hidrógeno (H)</option>
                <option value="He">Helio (He)</option>
                <option value="Li">Litio (Li)</option>
                <option value="Be">Berilio (Be)</option>
                <option value="B">Boro (B)</option>
                <option value="C">Carbono (C)</option>
                <option value="N">Nitrógeno (N)</option>
                <option value="O">Oxígeno (O)</option>
                <option value="F">Flúor (F)</option>
                <option value="Ne">Neón (Ne)</option>
                <option value="S">Azufre (S)</option>
            </select><br><br>
    
            <button type="submit">Agregar Pregunta</button>
        </form>
    
        <p id="mensaje"></p>

        </div>


      


    </main>
   
    <script>
        // Captura el evento de envío del formulario
        document.getElementById('formularioPregunta').addEventListener('submit', function(event) {
            event.preventDefault();

            // Obtén los valores del formulario
            const pregunta = document.getElementById('pregunta').value;
            const respuestaCorrecta = document.getElementById('respuestaCorrecta').value === 'true';
            const simboloElemento = document.getElementById('simboloElemento').value;

            // Envía los datos al servidor usando fetch
            fetch('/agregar-pregunta', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    question: pregunta,
                    correctAnswer: respuestaCorrecta,
                    elementSymbol: simboloElemento
                })
            })
            .then(response => response.json())
            .then(data => {
                // Muestra un mensaje basado en la respuesta del servidor
                const mensaje = document.getElementById('mensaje');
                if (data.success) {
                    mensaje.textContent = 'Pregunta agregada exitosamente a Elementum.';
                    mensaje.style.color = 'green';

                     // Deja el formulario en limpio
                     document.getElementById('formularioPregunta').reset();
                } else {
                    mensaje.textContent = 'Error al agregar la pregunta al juego.';
                    mensaje.style.color = 'red';
                }
            })
            .catch(error => {
                console.error('Error al enviar los datos:', error);
                document.getElementById('mensaje').textContent = 'Ocurrió un error al enviar los datos verifica que tenga signo de interrogación.';
            });
        });
    </script>

    <script> //para cargar el perfil del jugador
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/perfil')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('No autorizado');
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('nombre').textContent = data.nombre;
                    document.getElementById('correo').textContent = data.correo;
                    document.getElementById('usuario').textContent = data.usuario;
                })
                .catch(error => {
                    console.error('Error al cargar el perfil:', error);
                    alert('Debes iniciar sesión primero');
                    window.location.href = '/login.html';
                });
        });

        document.getElementById('logout').addEventListener('click', function(e) {
            e.preventDefault();
            fetch('/logout', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '/login.html';
                    } else {
                        throw new Error('Error al cerrar sesión');
                    }
                })
                .catch(error => {
                    console.error('Error al cerrar sesión:', error);
                    alert('Error al cerrar sesión');
                });
        });
    </script>
</body>
</html>