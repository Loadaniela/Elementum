<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego Bloques</title>
    <link rel="stylesheet" href="css/juego.css">
    <link rel="icon" href="/Imagenes/icon-512x512.png">
</head>
<body>
    <main>
    <input type="checkbox" id="toggle">
    <label for="toggle" class="hamburger">
        <span></span>
        <span></span>
        <span></span>
    
    </label>
    <nav class="menu">
        <ul>
            <li><a href="pagina1.html">Menú Principal</a></li>
            <li><a href="login.html" id="logout">Cerrar sesión</a></li>
            <li><a href="Perfil.html">PERFIL DEL JUGADOR</a></li>
            <p><strong style="color:rgb(119, 11, 241);">Jugador:</strong> <span id="nombre" style="color: white;"></span></p>
            <p><strong style="color: rgb(119, 11, 241);">Correo:</strong> <span id="correo" style="color: white;"></span></p>
            <p><strong style="color:rgb(119, 11, 241);">Usuario:</strong> <span id="usuario" style="color: white;"></span></p>
            
            <img src="Imagenes/oncahui.png" alt="panda" width="220" height="350">
        </ul>
    </nav>

   <!--- <h1 class="glitch"  data-text="Elementum">ELEMENTUM</h1>
    <p class="arrastres"><strong style="color: orange;">Número de arrastres realizados:</strong> <span id="contadorArrastres" style="color: white;">0</span></p>
-->
   
 <!--ELEMENTOS DE LA TABLA PERIODICA-->  
 
 <!--INICIA EL BLOQUE S-->
 <div class="resultados">
<div class="contenedor"> 
    <!--AQUI INICIA EL CONTENEDOR PADRE-->
    <h1 class="glitch"  data-text="Elementum">BLOQUES</h1>
    <p class="arrastres"><strong style="color: rgb(113, 15, 241);">Número de arrastres realizados:</strong> <span id="contadorArrastres" style="color: rgb(8, 3, 3);">0</span></p>
  
    
 <div class="bloqueS" id="bloqueS" ondrop="drop(event)" ondragover="allowDrop(event)" >
    
  
<div class="gas" id="eq1">

 </div>

 <div class="alcalino" id="eq3">
     
 </div>
 
<div class="alcalino" id="eq11">
     
 </div>
 
 <div class="alcalino" id="eq19">
   
 </div>
 
 <div class="alcalino" id="eq37">
     
 </div>
 
<div class="alcalino" id="eq55">
    
 </div>
 
 <div class="alcalino" id="eq87">
     
 </div>
   
 <div class="alcalinoterreos" id="eq4">

 </div>
     
 <div class="alcalinoterreos" id="eq12">

 </div>
     
 <div class="alcalinoterreos" id="eq20">
    
 </div>

 <div class="alcalinoterreos" id="eq38">
     
 </div>
     
 <div class="alcalinoterreos" id="eq56">
   
 </div>
 <div class="alcalinoterreos" id="eq2" style="border-color: greenyellow;"> 
   
 </div>
     
 <div class="alcalinoterreos" id="eq88">
   
 </div>
</div>
<!--AQUI TERMINA EL BLOQUE S-->


<div class="bloqueD" id="bloqueD" ondrop="drop(event)" ondragover="allowDrop(event)">
 <!--AQUI INICIA EL BLOQUE D-->
       
 <div class="transicion" id="eq21">
     
 </div>
         
 <div class="transicion" id="eq39">
    
 </div>
         
 <div class="transicion" id="eq5771">
    
 </div>
         
 <div class="transicion" id="eq89103">
   
 </div>
         
 <div class="transicion" id="eq22">
     
 </div>
         
<div class="transicion" id="eq40">
     
 </div>
         
 <div class="transicion" id="eq72">
    
 </div>
         
<div class="transicion" id="eq104">
 
 </div>
           
 <div class="transicion" id="eq23">
     
 </div>
           
<div class="transicion" id="eq41">
     
 </div>
           
 <div class="transicion" id="eq73">
     
 </div>
           
 <div class="transicion" id="eq105">
    
 </div>
      
 <div class="transicion" id="eq24">
    
 </div>
             
 <div class="transicion" id="eq42">
     
 </div>
             
 <div class="transicion" id="eq74">
     
 </div>
             
 <div class="transicion" id="eq106">
     
 </div>
               
<div class="transicion" id="eq25">
    
 </div>
             
 <div class="transicion" id="eq43">
     
 </div>
             
 <div class="transicion" id="eq75">
     
 </div>
             
 <div class="transicion" id="eq107">
    
 </div>
    
 <div class="transicion" id="eq26">
    
 </div>
             
 <div class="transicion" id="eq44">
     
 </div>
             
 <div class="transicion" id="eq76">
     
 </div>
             
 <div class="transicion" id="eq108">
    
 </div>
      
 <div class="transicion" id="eq27">
     
 </div>
             
 <div class="transicion" id="eq45">
     
 </div>
             
 <div class="transicion" id="eq77">
     
 </div>
             
 <div class="transicion" id="eq109">
     
 </div>
        
 <div class="transicion" id="eq28">
    
 </div>
             
<div class="transicion" id="eq46">
    
 </div>
             
 <div class="transicion" id="eq78">
    
 </div>
             
 <div class="transicion" id="eq110">
     
 </div>
          
 <div class="transicion" id="eq29">
     
 </div>
             
 <div class="transicion" id="eq47">
   
 </div>
             
 <div class="transicion" id="eq79">
    
 </div>
             
 <div class="transicion" id="eq111">
     
 </div>
            
 <div class="transicion" id="eq30">
     
 </div>
             
 <div class="transicion" id="eq48">
     
 </div>
             
 <div class="transicion" id="eq80">
     
 </div>

             
 <div class="transicion" id="eq112">
    
 </div>
</div>
<!--AQUI TERMINA EL BLOQUE D-->


<div class="bloqueP" id="bloqueP" ondrop="drop(event)" ondragover="allowDrop(event)">              
 <div class="metaloides" id="eq5">
    
 </div>
                 
 <div class="metales" id="eq13">
     
 </div>
                   
 <div class="metales" id="eq31">
    
 </div>
                   
 <div class="metales" id="eq49">
    
 </div>
                   
<div class="metales" id="eq81">
     
 </div>
                   
 <div class="desconocidos" id="eq113">
     
 </div>
                 
 <div class="metales" id="eq6">
    
 </div>

 <div class="metaloides" id="eq14">
    
 </div>
 
<div class="metaloides" id="eq32">
     
 </div>

 <div class="metales" id="eq50">
   
 </div>
 
 <div class="metales" id="eq82">
     
 </div>

 <div class="desconocidos" id="eq114">
     
 </div>
                   
<div class="metales" id="eq7">
     
 </div>

 <div class="metales" id="eq15">
    
 </div>
 
 <div class="metaloides" id="eq33">
     
 </div>

 <div class="metaloides" id="eq51">
    
 </div>
 
 <div class="metales" id="eq83">
     
 </div>

 <div class="desconocidos" id="eq115">
    
 </div>
                     
 <div class="metales" id="eq8">
     
 </div>

 <div class="metales" id="eq16">
    
 </div>
 
 <div class="metales" id="eq34">
    
 </div>

 <div class="metaloides" id="eq52">
     
 </div>
 
<div class="metales" id="eq84">
    
 </div>

 <div class="desconocidos" id="eq116">
    
 </div>
                       
 <div class="halogenos" id="eq9">
     
 </div>

 <div class="halogenos" id="eq17">
    
 </div>
 
<div class="halogenos" id="eq35">
     
 </div>

 <div class="halogenos" id="eq53">
     
 </div>
 
 <div class="halogenos" id="eq85">
    
 </div>

<div class="desconocidos" id="eq117" >
   
 </div>
    <!--                    
<div class="alcalinoterreos" id="eq2"> <p>ver</p>
    
 </div>-->
                     
 
 <div class="nobles" id="eq10" style="border-color: greenyellow;">
    
 </div>

<div class="nobles" id="eq18" style="border-color: greenyellow;">
   
 </div>
 
<div class="nobles" id="eq36" style="border-color: greenyellow;">
    
 </div>

<div class="nobles" id="eq54" style="border-color: greenyellow;">
     
 </div>
 
<div class="nobles" id="eq86" style="border-color: greenyellow;">
     
 </div>

 <div class="nobles" id="eq118" style="border-color: greenyellow" style="border: 10%;"; >
     
 </div>
</div>
<!--AQUI TERMINA EL BLOQUE P-->


<div class="bloqueF" id="bloqueF" ondrop="drop(event)" ondragover="allowDrop(event)"> 
<!--AQUI INICIA EL BLOQUE F-->
 <div class="lantanidos" id="eq57">
    
 </div>
 
 <div class="lantanidos" id="eq58">
     
 </div>
 
 <div class="lantanidos" id="eq59">
     
 </div>
 
 <div class="lantanidos" id="eq60">
     
 </div>
 
 <div class="lantanidos" id="eq61">
    
 </div>
 
 <div class="lantanidos" id="eq62">
    
 </div>
 
<div class="lantanidos" id="eq63">
     
 </div>
 
<div class="lantanidos" id="eq64">
     
 </div>
 
 <div class="lantanidos" id="eq65">
     
 </div>
 
 <div class="lantanidos" id="eq66">
     
 </div>
 
 <div class="lantanidos" id="eq67">
    
 </div>

 <div class="lantanidos" id="eq68">
    
 </div>
 
<div class="lantanidos" id="eq69">
    
 </div>

<div class="lantanidos" id="eq70">
    
 </div>

 <div class="lantanidos" id="eq71">
    
 </div>

<div class="actinidos" id="eq89">
    
 </div>
 
<div class="actinidos" id="eq90">
     
 </div>
 
<div class="actinidos" id="eq91">
    
 </div>
 
<div class="actinidos" id="eq92">
    
 </div>
 
<div class="actinidos" id="eq93">
    
 </div>
 
 <div class="actinidos" id="eq94">
    
 </div>
 
 <div class="actinidos" id="eq95">
   
 </div>
 
 <div class="actinidos" id="eq96">
     
 </div>
 
 <div class="actinidos" id="eq97">
    
 </div>
 
 <div class="actinidos" id="eq98">
    
 </div>
 
 <div class="actinidos" id="eq99">
    
 </div>
 
 <div class="actinidos" id="eq100">
    
 </div>
 
 <div class="actinidos" id="eq101">
    
 </div>
    
    <div class="actinidos" id="eq102">
    
    </div>

    <div class="actinidos" id="eq103">
    
     </div>
   


<!--AQUI TERMINA EL BLOQUE F-->

<!--por si no jalan aqui estan-->
<div class="bloquesN">
    <div class="bloques" id="F" draggable="true" ondragstart="drag(event)" data-categoria="bloqueF"><strong>Transición interna</strong></div>
    <div class="bloques" id="P" draggable="true" ondragstart="drag(event)" data-categoria="bloqueD"><strong>Transición</strong></div>
    <div class="bloques" id="D" draggable="true" ondragstart="drag(event)" data-categoria="bloqueP"><strong>Nobles</strong></div>
    <div class="bloques" id="S" draggable="true" ondragstart="drag(event)" data-categoria="bloqueS"><strong>Representativos</strong></div>
    <div class="bloques" id="F" draggable="true" ondragstart="drag(event)" data-categoria="bloqueF"><strong>Bloque F</strong></div>
    <div class="bloques" id="P" draggable="true" ondragstart="drag(event)" data-categoria="bloqueP"><strong>Bloque P</strong></div>
    <div class="bloques" id="D" draggable="true" ondragstart="drag(event)" data-categoria="bloqueD"><strong>Bloque D</strong></div>
    <div class="bloques" id="S" draggable="true" ondragstart="drag(event)" data-categoria="bloqueS"><strong>Bloque S</strong></div>
    
</div>
</div>

</div>
 </div>
 </div>
</main>



<script> 
    document.addEventListener('DOMContentLoaded', function() {
                fetch('/perfil')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('No autorizado');
                        }
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById('nombre').textContent = data.nombre;
                        document.getElementById('correo').textContent = data.correo;
                        document.getElementById('usuario').textContent = data.usuario;
                    })
                    .catch(error => {
                        console.error('Error al cargar el perfil:', error);
                        alert('Debes iniciar sesión primero');
                        window.location.href = '/login.html';
                    });
            });


                        // Función para obtener el ID del juego desde la URL
            function obtenerIdJuegoDeURL() {
                const urlActual = window.location.pathname; // Obtiene la ruta del archivo
                if (urlActual.includes('juego.html')) return 1;
                if (urlActual.includes('juego2.html')) return 2;
                if (urlActual.includes('juego3.html')) return 3;
                if (urlActual.includes('juego4.html')) return 4;
                return null; // En caso de que no se encuentre un juego válido
            }

            // Función para registrar la entrada del usuario al juego
            function registrarEntradaJuego(userId, juegoId) {
                fetch('/api/entrada-juego', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ userId, juegoId })
                })
                .then(response => response.json())
                .then(data => console.log('Entrada registrada:', data))
                .catch(error => console.error('Error registrando entrada:', error));
            }

            document.getElementById('logout').addEventListener('click', function(e) {
                e.preventDefault();
                fetch('/logout', { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = '/login.html';
                        } else {
                            throw new Error('Error al cerrar sesión');
                        }
                    })
                    .catch(error => {
                        console.error('Error al cerrar sesión:', error);
                        alert('Error al cerrar sesión');
                    });
            });

  </script>

<!-- Incluye SweetAlert2 desde CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



<script> //ventanas de swet alart para salir
    // Variable para indicar si el juego ha terminado
    let juegoTerminado = false;

    /* Manejo del evento beforeunload (solo para recarga o cierre de pestaña)
    window.addEventListener('beforeunload', function (event) {
        if (!juegoTerminado) {
            const message = "Estás a punto de salir del juego. Los datos podrían no guardarse.";
            event.returnValue = message; // Mensaje predeterminado del navegador
            return message;
        }
    });*/

    // Manejo de clicks en enlaces o botones que navegan fuera del sitio
    document.querySelectorAll('a, button').forEach(function(element) {
        element.addEventListener('click', function(event) {
            if (!juegoTerminado) {
                event.preventDefault(); // Previene la acción predeterminada de navegación
                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "Estás a punto de salir del juego. Los datos podrían no guardarse.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Sí, salir',
                    cancelButtonText: 'No, quedarse'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Permitir navegación después de la confirmación
                        window.location.href = element.href || element.getAttribute('data-href');
                    }
                });
            }
        });
    });

    // Manejo del evento popstate (retroceso del navegador)
    window.addEventListener('popstate', function (event) {
        if (!juegoTerminado) { 
            Swal.fire({
                title: '¿Estás seguro?',
                text: "Estás a punto de salir del juego. Los datos podrían no guardarse.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, salir',
                cancelButtonText: 'No, quedarse'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.history.back();
                } else {
                    history.pushState(null, null, window.location.href);
                }
            });
        }
    });

    // Simulamos una entrada de historial para manejar el popstate correctamente
    window.history.pushState(null, null, window.location.href);
</script>




<script> 
    // Contador de arrastres y elementos correctos
    let arrastresContador = 0;
    let correctosContador = 0;

    const totalElementos = 4; // Número total de elementos a arrastrar
    const sonidoAcierto = new Audio('audio/acierto.mp3'); // Ruta al archivo de sonido de acierto
    const sonidoError = new Audio('audio/error.mp3'); // Ruta al archivo de sonido de error

    // Función para mezclar el array
    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Función para mezclar los nombres de los elementos al cargar la página
    document.addEventListener("DOMContentLoaded", function () {
        const bloquesContainer = document.querySelector(".bloquesN");
        const bloques = Array.from(bloquesContainer.children);

        // Array de nombres posibles
        const nombresMap = [
            { categoria: 'bloqueF', nombre: 'Transición interna' },
            { categoria: 'bloqueD', nombre: 'Transición' },
            { categoria: 'bloqueP', nombre: 'Representativos y nobles' },
            { categoria: 'bloqueS', nombre: 'Representativos' },
            { categoria: 'bloqueF', nombre: 'Bloque F' },
            { categoria: 'bloqueP', nombre: 'Bloque P' },
            { categoria: 'bloqueD', nombre: 'Bloque D' },
            { categoria: 'bloqueS', nombre: 'Bloque S' }
            
        ];

        // Mezcla los nombres
        const nombresAleatorios = shuffle(nombresMap).slice(0, 4); // Selecciona 4 aleatorios

        // Asignar los nombres mezclados a los bloques
        bloques.forEach((bloque, index) => {
            if (index < 4) {
                bloque.innerHTML = `<strong>${nombresAleatorios[index].nombre}</strong>`;
                bloque.setAttribute('data-categoria', nombresAleatorios[index].categoria);
            } else {
                bloque.style.display = 'none'; // Esconder los elementos no seleccionados
            }
        });
    });

    // Función que permite el arrastre
    function drag(event) {
        event.dataTransfer.setData("text", event.target.id);
    }

    // Función que permite soltar el elemento sobre un contenedor
    function allowDrop(event) {
        event.preventDefault();
    }

    // Función que maneja la acción de soltar el elemento
    function drop(event) {
        event.preventDefault();
        arrastresContador++; // Incrementa el contador de arrastres
        var data = event.dataTransfer.getData("text");
        var element = document.getElementById(data);
        
        // Identifica el contenedor al que se intenta soltar
        var targetContainer = event.target.closest('.bloqueS, .bloqueD, .bloqueP, .bloqueF');

        // Verifica si el contenedor existe y si el `data-categoria` del elemento coincide con el ID del contenedor
        if (targetContainer) {
        const categoriaElemento = element.getAttribute('data-categoria');
        const categoriaContenedor = targetContainer.id;

        if (categoriaElemento === categoriaContenedor) {
            // Calcula las coordenadas relativas del evento drop dentro del contenedor
            const rect = targetContainer.getBoundingClientRect();
            const offsetX = event.clientX - rect.left;
            const offsetY = event.clientY - rect.top;

            // Usa position absolute para posicionar el elemento donde se soltó
            element.style.position = "absolute";
            element.style.left = `${offsetX}px`;
            element.style.top = `${offsetY}px`;

            // Añade el elemento al contenedor
            targetContainer.appendChild(element);

            // Deshabilita el arrastre del elemento para que no pueda ser movido nuevamente
            element.setAttribute("draggable", "false");
            element.style.cursor = "default"; // Cambia el cursor a normal

            // Incrementa el contador de elementos correctos
            correctosContador++;
            sonidoAcierto.play(); // Reproduce el sonido de acierto
        } else {
            sonidoError.play(); // Reproduce el sonido de error
        }
    } else {
        sonidoError.play(); // Reproduce el sonido de error
    }

    
        // Actualiza el contador de arrastres en la página
        document.getElementById("contadorArrastres").textContent = arrastresContador;
        
        // Verifica si todos los elementos han sido colocados correctamente
        if (correctosContador === totalElementos) {
            Swal.fire({
                title: '¡Felicidades!',
                text: `Has colocado todos los elementos correctamente en ${arrastresContador} arrastres.`,
                icon: 'success',
                confirmButtonText: 'Aceptar'
            }).then(() => {
                // Guardar el resultado del juego en la base de datos
                const userId = document.getElementById('usuario').textContent;
                const juegoId = obtenerIdJuegoDeURL();
                
                guardarResultadoJuego(userId, juegoId, arrastresContador);
            });
        }
    }

    // Función para guardar el resultado del juego
    function guardarResultadoJuego(userId, juegoId, numArrastres) {
        const nombreJuego = obtenerNombreJuego(juegoId);
    
        fetch('/guardar-resultado', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userId, juegoId, numArrastres })
        })
        .then(response => response.json())
        .then(data => {
            console.log('Resultado guardado:', data);
    
            if (data.message === 'Resultado guardado correctamente') {
                window.location.href = 'marcador.html';
            } else {
                Swal.fire({
                    title: 'Error al guardar resultados',
                    text: data.error || 'Error desconocido',
                    icon: 'error',
                    confirmButtonText: 'Aceptar'
                });
            }
        })
        .catch(error => {
            Swal.fire({
                title: 'Error de red',
                text: 'Por favor intenta nuevamente.',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
        });
    }

    // Función para obtener el nombre del juego
    function obtenerNombreJuego(juegoId) {
        switch (parseInt(juegoId)) {
            case 1: return 'Bloques';
            case 2: return 'Elementos';
            case 3: return 'RadioA';
            case 4: return 'Electronegatividad';
            default: return 'Juego desconocido';
        }
    }
</script>



  </body>
</html>